name: auto-update-config

on:
  workflow_dispatch: # 手动触发
  schedule: # 计划任务触发
    - cron: '0 23 * * *'

env:
  JSON_CONFIG_URL: ${{secrets.JSON_CONFIG_URL}}

jobs:

  run-daily-task:

    runs-on: ubuntu-latest
    environment: Production

    steps:
      
      - name: Set timezone
        run: sudo timedatectl set-timezone 'Asia/Shanghai'
      
      - name: Checkout
        uses: actions/checkout@main
      
      - name: Setup .NET
        uses: actions/setup-dotnet@v2
        with:
          dotnet-version: 7.0.x
      
      - name: Run
        run: |
          cd ./src/AutoClash.ConsoleApp
          dotnet run